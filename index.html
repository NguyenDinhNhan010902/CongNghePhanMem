<!DOCTYPE html>
<html>
<head>
    <title>Brick Breaker</title>
    <style>
        *{
            font-family: "Germania One";
        }

        #gameover{
            position: absolute;
            width : 400px;
            height: 500px;
            display: none; // ẩn phần tử
        }
        #youwin{
            width: 100px;
            position: absolute;
            top : 200px;
            left : 150px;
            display: none;
        }
        #youlose{
            width:400px;
            position: absolute;
            top: 100px;
            display: none;
        }
        #restart{
            position: absolute; // thuộc tính vị trí
            bottom: 50px;
            top: 300px;
            left : 155px;
            cursor: pointer;// hình dạng con trỏ chuột
            font-size: 10px;
            color : #ab0c0c;
        }
    </style>
</head>
<body>
    <div class="contener">
    <div class="position">
        <canvas id="myCanvas" width="800;" height="600;" ></canvas>
        <!-- <canvas id="Canvas" width="500" height="20" style="background: red; " ></canvas> -->
       
    </div>
    <div class="btn">
        <button id="start" style="width: 150px; height: 30px;">Start Game</button>
        <button id="tamngung" style="width: 150px; height: 30px;">Pause Game</button>
       
    </div>
    <!-- <div class="obstacle" id="obstacle1" style="width: 200px;  top:200px;
    left: 800px;"></div> -->
    <!-- <div class="obstacle" id="obstacle2"></div>
    <div class="obstacle" id="obstacle3"></div> -->
   
    </div>
    












    <script>


    var canvas = document.getElementById("myCanvas");
    var tc1 = document.getElementById("Canvas");
    var ctx = canvas.getContext("2d");
    var dtBall = 10;
    var x = canvas.width/2;
    var y = canvas.height-30;
    var dx = 2;
    var dy = -2;
    var tneHeight = 20;
    var tnWidth = 100;
    var paddleX = (canvas.width-tnWidth)/2;
    var brickRow = 5;
    var brickCol = 9;
    var brickWidth = 75;
    var brickHeight = 20;
    var brickPadding = 10;
    var brickOffsetTop = 30;
    var brickOffsetLeft = 30;
    var diem = 0;
    var bricks = [];
    // var obstacle = document.getElementById("obstacle1");
    
    // chứa số lượng gạch
    for(var c=0; c<brickCol; c++) {
        bricks[c] = [];
        for(var r=0; r<brickRow; r++) {
            bricks[c][r] = { x: 0, y: 0, status: 1 };
        }
    }
    // nhận sự kiện từ bàn phím
    document.addEventListener("keydown", phimphai, false);
    document.addEventListener("keyup", phimtrai, false);
    // nhận siwj kiện từ chuột
    document.addEventListener("mousemove", chuot, false);

    // khi nhấn phím thanh ngang bên dưới sẽ di chuyển theo phím phải
    var rightP = false;
    var leftP = false;
    function phimphai(e) {
        if(e.key == "phia" || e.key == "ArrowRight") {
            rightP = true;
        }
        else if(e.key == "Left" || e.key == "ArrowLeft") {
            leftP = true;
        }
    }
    // khi nhấn phím thanh ngang bên dưới sẽ di chuyển theo phím trái

    function phimtrai(e) {
        if(e.key == "Right" || e.key == "ArrowRight") {
            rightP = false;
        }
        else if(e.key == "Left" || e.key == "ArrowLeft") {
            leftP = false;
        }
    }
    // nhận sự kiện từ chuột
    function chuot(e) {
        var relativeX = e.clientX - canvas.offsetLeft;
        if(relativeX > 0 && relativeX < canvas.width) {
            paddleX = relativeX - tnWidth/2;
        }
    }

    function collisionDetection() {
        // mảng 2 chiều hiển thị số lượng gạch brickColumnCount số cột brickRowCount số hàng
        for(var c=0; c<brickCol; c++) {
            for(var r=0; r<brickRow; r++) {
                var b = bricks[c][r];

                if(b.status == 1) {
                    // kiểm tra tạo độ bóng có trùng với 1 ô gạch nào hay không
                    if(x > b.x && x < b.x+brickWidth && y > b.y && y < b.y+brickHeight) {

                        dy = -dy; // chiều mà bóng bay về khi va chạm vàogachj
                        b.status = 0;
                        diem++;
                        if(diem == brickRow*brickCol) {
                            alert("YOU WIN, CONGRATULATIONS!");
                            document.location.reload();
                        }
                    }
                }
            }
        }
    }

//vẽ bóng
  function drawball(){//vẽ bằng cách sử dụng hàm ctx.beginPath()
         scn.beginPath();
         scn.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);//Sử dụng hàm scn.arc() để vẽ một hình tròn với tọa độ (x, y) và bán kính là ball.radius.
         // Hàm này sử dụng toán tử Math.PI để tính toán giá trị độ dài cung của hình tròn.
 
         scn.fillStyle = "#7FFF00";//tô màu cho hình tròn
         scn.fill();//Gọi hàm ctx.fill() để vẽ hình tròn được tô màu.

         scn.strokeStyle = "#000000";//vẽ đường viền cho hình tròn
         scn.stroke();//Gọi hàm ctx.stroke() để vẽ đường viền.

         scn.closePath();//Kết thúc quá trình vẽ bằng cách sử dụng hàm ctx.closePath().
     }

     // di chuyển quả bóng
     function moveball(){
         ball.x += ball.dx;// thay đổi vị trí x của bóng bằng dx
         ball.y += ball.dy;
     }

     // //kiểm tra va chạm bóng và tường và đáy
     function ballConllision(){
         if(ball.x + ball.radius > bgr.width || ball.x - ball.radius < 0){//Nếu tọa độ x của bóng vượt quá chiều rộng của canvas trừ đi bán kính của bóng hoặc
             // tọa độ x của bóng nhỏ hơn bán kính của bóng, bóng sẽ chạm vào tường bên
             ball.dx = - ball.dx;// phải đổi hướng di chuyển theo trục x bằng cách đổi dấu biến đổi dx của bóng.
             wall.play();// âm thanh chạm tường sẽ phát
         }

         if(ball.y - ball.radius < 0){//Nếu tọa độ y của bóng nhỏ hơn bán kính của bóng, bóng sẽ chạm vào tường trên
             ball.dy = -ball.dy;//phải đổi hướng di chuyển theo trục y bằng cách đổi dấu biến đổi dy của bóng
             wall.play(); // âm thanh chạm tường
         }

         if(ball.y + ball.radius > bgr.height){//Nếu tọa độ y của bóng vượt quá chiều cao của canvas trừ đi bán kính của bóng, bóng đã rơi xuống đáy
             life--; //Biến LIFE sẽ bị giảm đi một đơn vị,
             life_audio.play();//âm thanh LIFE_LOST sẽ được phát
             resetball();//hàm resetBall() sẽ được gọi để đặt lại vị trí của bóng.
         }
     }

        // function designPaddle() {
        // ctx.beginPath();
        // ctx.rect(paddleX , canvas.height-200, tnWidth, tneHeight);
        // ctx.fillStyle = "#000";
        // ctx.fill();
        // ctx.closePath();
        // }

       

       



        
        function drawBricks() {
        for(var c=0; c<brickCol; c++) {
        for(var r=0; r<brickRow; r++) {
        if(bricks[c][r].status == 1) {
            // công thức tính toạ độ của ô gạch
        var brickX = (c*(brickWidth+brickPadding))+brickOffsetLeft;
        var brickY = (r*(brickHeight+brickPadding))+brickOffsetTop;
        bricks[c][r].x = brickX;
        bricks[c][r].y = brickY;
        ctx.beginPath();
        ctx.rect(brickX, brickY, brickWidth, brickHeight);
        ctx.fillStyle = "#000";
        ctx.fill();
        ctx.closePath();
        }
        }
        }
        }
        
        function drawDiem() {
        ctx.font = "16px Arial";
        ctx.fillStyle = "#000";
        ctx.fillText("Điểm: "+diem, 8, 20);
        }
        //vẽ giao diện game 
        function drawGD() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBricks();
        designBall();
        designPaddle();
        // designPaddle1();
        drawDiem();
        collisionDetection();
       
        //xử lý va chạm của bóng với các biên đc tạo từ canvas
        if(x + dx > canvas.width-dtBall || x + dx < dtBall) {
            dx = -dx;
        }
        
        if(y + dy < dtBall) {
            dy = -dy;
        }
    //    xử lí va chạm với thanh điều khiển
        else if(y + dy > canvas.height-dtBall) {
            if(x > paddleX && x < paddleX + tnWidth) {
                dy = -dy;
            }
           
            else {
                alert("GAME OVER");
                document.location.reload();
            }
        }
        // xử lý tốc độ di chuyển cảu thanh điều khiển
        if(rightP && paddleX < canvas.width-tnWidth ) {
            paddleX += 7;
        }
        else if(leftP && paddleX > 0) {
            paddleX -= 7;
        }
        
        x += dx;
        y += dy;
        }
        //xử lý sự kiện mút bắt đầu 
        var start = document.getElementById("start");
        start.addEventListener("click", function() {
        button = setInterval(drawGD, 10);
});
        //xử lý sự kiện nút tạm ngưng
        var tamngung = document.getElementById("tamngung");
        tamngung.addEventListener("click", function() {
            clearInterval(button);
        });
       


    </script>
</body>
</html>